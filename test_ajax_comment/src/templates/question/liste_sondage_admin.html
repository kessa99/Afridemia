{% extends 'base/base.html' %}



{% block title %}Sondage{% endblock %}
{% load static %}
{% block content %}

<div class="px-8 pb-8 w-full max-w-[1350px] mx-auto">
    <!--------------------------------------- mini navbar --------------------------------------->
  
    <nav
      class="mx-auto my-4 flex flex-row justify-between items-center gap-4 text-xs w-full max-w-[1350px]"
    >
      <!-- {% if user.is_staff %} -->
      <div class="flex gap-4">
        <a
          class="hover:text-green-300 transition ease-in duration-300"
          href=""
          >
          hello<i class="fa-solid fa-house"></i>
        </a>
        /
        <a
          class="hover:text-green-400 transition ease-in duration-300"
          href=""
          >Livres</a
        >
      </div>
      <!-- {% endif %} {% if user.is_authenticated %} -->
      <a
        href=""
        class="px-3 py-2 bg-blue-950 text-xs text-white hover:text-green-300 flex items-center rounded-lg transition duration-300 ease-in"
        >Nouveau Livre<i class="fa-solid fa-plus ml-2"></i
      ></a>
      <a
        href="{% url 'home' %}"
        class="px-3 py-2 bg-blue-950 text-xs text-white hover:text-green-300 flex items-center rounded-lg transition duration-300 ease-in"
        >Retour<i class="fa-solid fa-plus ml-2"></i
      ></a>
      <!-- {% endif %} -->
    </nav>
  
    <!--------------------------------------- books --------------------------------------->
    <section id="books" class="w-full flex flex-col xl:flex-row gap-8 text-left">
      <div class="text-sm flex flex-col xl:w-[300px] gap-3 xl:fixed z-30">
        <form
          action=""
          class="p-3 w-full bg-slate-300 rounded-xl flex xl:flex-col gap-4"
        >
          <input
            placeholder="Titre"
            name="query"
            type="text"
            class="px-4 py-2 rounded-md text-sm focus:bg-sky-100 w-full"
          />
          <input
            placeholder="Auteur"
            name="query"
            type="text"
            class="px-4 py-2 rounded-md text-sm focus:bg-sky-100 w-full"
          />
          <input
            placeholder="Langue"
            name="query"
            type="text"
            class="px-4 py-2 rounded-md text-sm focus:bg-sky-100 w-full"
          />
  
          <select
            name="query"
            class="px-4 py-2 rounded-md text-sm focus:bg-sky-100 w-full"
          >
            <option value="" disabled selected>Telechargeable</option>
            <option value="true">Oui</option>
            <option value="false">Non</option>
          </select>
          <div class="flex gap-3">
            <a
              href=""
              class="px-3 py-2 rounded-lg text-sm text-black hover:text-white hover:bg-blue-950 transition duration-300 ease-in"
            >
              <i class="fa-solid fa-rotate-right"></i>
            </a>
            <button
              class="px-4 py-2 w-full bg-slate-200 text-black hover:bg-green-200 rounded-md transition duration-300 ease-in"
              type="submit"
            >
              Filtrer <i class="fa-solid fa-filter"></i>
            </button>
          </div>
        </form>



      </div>
  
      <div x-data="{ openModal: false }" class="xl:ml-80 w-full ml-20">
        <table class="w-full">
          <thead>
            <tr>
              <th class="border px-4 py-2">no.</th>
              <th class="border px-4 py-2">Questions</th>
              <th class="border px-4 py-2">Reponse</th>
              <th class="border px-4 py-2">Sondage</th>
            </tr>
          </thead>
      
          <tbody>
            {% for quest in questions %}
            <tr>
              <td class="border px-4 py-2">{{ forloop.counter }}</td>
              <td class="border px-4 py-2">{{ quest.question_test }}</td>
              <td class="border px-4 py-2">
                <button @click="openModal = true" class="px-3 py-2 rounded-lg text-sm bg-blue-950 text-white hover:text-blue-950 hover:bg-white transition duration-300 ease-in">Resultat du sondage</button>
      
                <!-- Modal Structure -->
                <div x-show="openModal" @click.away="openModal = false" id="modal-{{forloop.counter}}" class="fixed inset-0 z-50 flex items-center justify-center hidden">
                  <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
      
                  <div class="bg-white rounded-lg overflow-hidden max-w-md w-full">
                    <div class="px-6 py-4">
                      <h4 class="text-lg font-semibold">Resultat du sondage</h4>
                      <table class="w-full">
                        <thead>
                          <tr>
                            <th class="border px-4 py-2">Id</th>
                            <th class="border px-4 py-2">Reponse</th>
                            <th class="border px-4 py-2">Pourcentage</th>
                          </tr>
                        </thead>
      
                        <tbody>
                          {% for answer in questions.answers.all %}
                          <tr>
                            <td class="border px-4 py-2">{{forloop.counter}}</td>
                            <td class="border px-4 py-2">{{answer.answer_text}}</td>
                            <td class="border px-4 py-2">{{answer.calculate_percentage}}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
      
                    <div class="px-6 py-4 bg-gray-100 border-t">
                      <button @click="openModal = false" class="px-3 py-1 bg-blue-950 text-white rounded-md">Accepter</button>
                    </div>
                  </div>
                </div>
              </td>
      
              <td class="border px-4 py-2">
                <a href="/question/{{question.uid}}" target="_blank" class="px-3 py-2 rounded-lg text-sm bg-blue-950 text-white hover:text-blue-950 hover:bg-white transition duration-300 ease-in">Ouvrir</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      
    </section>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.min.js" defer></script>
{% endblock %}